DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Creuna.Episerver.RedirectHandler.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201703072121131_initial'
BEGIN
    CREATE TABLE [dbo].[CustomRedirects] (
        [Id] [uniqueidentifier] NOT NULL,
        [NewUrl] [nvarchar](max) NOT NULL,
        [OldUrl] [nvarchar](max) NOT NULL,
        [AppendMatchToNewUrl] [bit] NOT NULL,
        [ExactMatch] [bit] NOT NULL,
        [IncludeQueryString] [bit] NOT NULL,
        [State] [int] NOT NULL,
        [NotfoundErrorCount] [int] NOT NULL,
        CONSTRAINT [PK_dbo.CustomRedirects] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201703072121131_initial', N'Creuna.Episerver.RedirectHandler.Migrations.Configuration',  0x1F8B0800000000000400CD584972DB4614DDA72A7740619554C96C91DA242AD02E99A214564CD11625EF9BC027D4954637DC834C9E2D8B1C2957F007310FA440D11976E8E1BF3F0F8DBFFFFCCB7BB789B8F30C4A3329C6EE7070EE3A207C1930118E5D6BD66F7E71DFBDFDF1076F1A441BE7737EEF22B98794428FDD2763E24B42B4FF0411D58388F94A6AB936035F468406928CCECF7F25C32101847011CB71BC7B2B0C8B60B7C0E5440A1F6263299FCB00B8CEF6F164B94375EE68043AA63E8CDD89022BE8601A330D0A051FDC43C014F8E6372A028EEB895430B8A686BACE156714255C025FBB0E15421A6A50FECB470D4BA3A40897316E50FEB08D01EFAD29D790E975595EEFABE2F9285191948439946FB591D19180C38BCC66A449FE2ACBBB854DD1AA53B4BED9265AEF2C8B46DDB1C82DE93A4D969713AE92EB7DCD5FC7D38DF599F312CA59116AA301C6E4608824961BAB602CC01A45F999F3D1AE38F37F87ED83FC03C45858CEAB4AA29A7856DBC0AD8F4AC6A0CCF61ED699EAB3C075489D8E34090BB20A4D6A8E5BCBF0FB0E79D315872284C841F23BF8FAA8780E819188C9E63A73BAF90022344F63173F5DE7866D20C87732DC47C1303791C8280B47F35DF0E03FE17B15C720823935FED383AC2BFF5E4A0E541C0D39DD50DFEC104F459A099FDB003E5950DBDC24A7212E3167A0B032D69EC12D986CF3D84891662DAD08A64A4935C12F93E3CE84B918BD80E79132D1EBE96FA34AF297D2CDF40DA76159094F2D0349152E94FFE7B21EC33300C5B7E8BBAA71EA969D43B40295BB883E03E6ED67CA2DAECE5B6EA85FB661083AADBC19C5F030C52C14A87EC960D4F64BEA817651C6566828130554BD7226A7B0E92AD0D8D232E7E82C4BEBF2A5E84B309DB8DA75CA50C982B6D913BA22AB90B6ECD8246DD9796B277B7ABB37A7718C0EABF4FA6CC759668DFECDF2F84E17A518C4D71D0DAF90B6E064A4A221344E91354A7AC394364900AF68920A93206A5FEBF4CD1EBBE73CBBCDDFEC53A53772BAE43BA3ED9F7B0D1F36B89436BF41334420CCCE2250C8DC1A0C5A00BB118D72AA3A3AE444721B897D5DF61075DE23AA08F95E7F94BCDD5551F2BDFE289DCDAB0AD979A13F7EB5935561ABFBFDD1BABA59CD0F1DE7FDD1B3365105CCB68EF06D474BABF9B9E3BC8DEE9146E4361388B432A831E33513F350756B5E29B81755AE51CDBCACB2F478CE344B4D7AC575D06CCF2C48CACC72AB0D4469422FBFF00967901825BF30A782ADB13FA50DD1C597C3A8F1F2F9FFBC4288D6013FEA29F2AF4FF456B02F16D0B028D89A813A71BA17CF54F94F54FD14D1CDCF274EECA7611D98C257CC7C8709FC3528FBA7EFD7A0D5266F268E07D83F6FBF8CB67FDAEE9CEB5A23C631F35A8F712DAD2363375849D42195BA35F4BD72A66B57378F547FE978D7A0595842243F780472C4B25182E67766622D7337A0BE5589F22B0D2FCDC1D000CD76A53045310AF1D807AD77C1934DDC539CC683995858135B73A5354EE77C5BD5D72387F9EF06D7BACCDE224E56FA7BA8806232540116E2BD65BC7C29DC74C4D51E8824826E01F777E5189307E1C26D817427454FA0CC7CD790D4072C7B0F10C51CC1F44224EFA4D7C886AF910F10527F9B37A9FD202F3BA26E76EF9AD150D1486718257DF29B9224FF29DF7E0359C580C7D9140000 , N'6.1.3-40302')
END

